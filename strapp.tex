\documentclass{article}
\title{Applicative Functors with Strings}
\author{Shunsuke Sogame}

\usepackage{my,cat,lambdax,hask,strd,strdproof,strdexternal}
\usepackage[outline]{contour}
\contourlength{.8pt}
\newcommand*{\ouroverlap}[1]{\contour{white}{\ensuremath{#1}}}

\allowdisplaybreaks
\mynoabstract

\include{refsetup}

\usetikzlibrary{external}
\tikzexternalize[prefix=out/]
\graphicspath{ {out/} }


\begin{document}

\maketitle


\section{Introduction}

We will show how applicative functors are depicted in \emph{string diagrams}. %
Don't trust my poor mathematics. Any correction is welcome at %
\href{https://github.com/okomok/strcat}{github.com/okomok/strcat}.  


\section{String Diagrams}
\strdexternalname{strapp_string_diagrams}

We introduce \emph{string diagrams}, which are useful for category theory. %
Don't be afraid. A string diagram in this document is just a kind of expression trees.

\subsection{Vertical Composition}

First we define how to join strings.

\In{definition}{
    A type $a$ is depicted as a string:
    \In{align*}{
        \strdexternal\strdgathered{
            \strdmid,\strdrlabel{a}
        }
    }
    Type names are often omitted.
}

\In{definition}{
    A function is depicted as a node:
    \In{align*}{
        \strdexternal\strdgathered{
            \strdmid,\strdrlabel{b}
            ,\strdcell{f}
            ,\strdmid,\strdrlabel{a}
        }
        \mydefeq
        f \haskop{::} a \haskop{->} b
    }
}

\In{definition}{
    An identity function is indistinguishable from a type:
    \In{align*}{
        \strdexternal\strdgathered{
            \strdmid,\strdrlabel{a}
        }
        \mydefeq
        \strdexternal\strdgathered{
            \strdmid,\strdrlabel{a}
            ,\strdcell{\texttt{id}}
            ,\strdmid,\strdrlabel{a}
        }
    }
}

%\In{definition}{
\definitionof{Vertical Composition}{
    The function composition joins strings: 
    \In{align*}{
        \strdexternal\strdgathered{
            \strdmid,\strdrlabel{c}
            ,\strdcell{g}
            ,\strdmid,\strdrlabel{b}
            ,\strdcell{f}
            ,\strdmid,\strdrlabel{a}
        }
        \mydefeq
        \strdexternal\strdgathered{
            \strdmid,\strdrlabel{c}
            ,\strdcell{g\texttt{.}f}
            ,\strdmid,\strdrlabel{a}
        }
    }
}

One can check that any diagram built upon these definitions has no ambiguity due to the famous laws:
\In{align*}{
    h\haskdot(g\haskdot f) &= (h\haskdot g) \haskdot f \\
    \texttt{id}\haskdot f &= f \\
    g\haskdot \texttt{id} &= g \\
}

%\In{definition}{
\definitionof{Value}{
    Strings for the unit type \texttt{()} can be omitted so that a value $x \haskop{::} a$ is represented as
    \In{align*}{
        \strdexternal\strdgathered{
            \strdmid,\strdrlabel{a}
            ,\strdcell{x}
        }
    }
}

For example, a function application $f\,x$ is depicted as
\In{align*}{
    \strdexternal\strdgathered{
        \strdmid,\strdrlabel{b}
        ,\strdcell{f}
        ,\strdmid,\strdrlabel{a}
        ,\strdcell{x}
    }
}


Due to the following definition, equations containing diagrams can often be simplified, known as \emph{pointfree} style.

\definitionof{Function Equality}{
    \In{align*}{
        \strdexternal\strdgathered{
            \strdmid,\strdrlabel{b}
            ,\strdcell{f}
            ,\strdmid,\strdrlabel{a}
            ,\strdcell{x}
        }
        \underset{\forall x}{=}
        \strdexternal\strdgathered{
            \strdmid,\strdrlabel{b}
            ,\strdcell{g}
            ,\strdmid,\strdrlabel{a}
            ,\strdcell{x}
        }
        \iff
        \strdexternal\strdgathered{
            \strdmid,\strdrlabel{b}
            ,\strdcell{f}
            ,\strdmid,\strdrlabel{a}
        }
        =
        \strdexternal\strdgathered{
            \strdmid,\strdrlabel{b}
            ,\strdcell{g}
            ,\strdmid,\strdrlabel{a}
        }
    }
}



\subsection{Functors}
\strdexternalname{strapp_functors}

\definitionof{Functional Box}{
    Given a function $k \haskop{::} (a \haskop{->} b) \haskop{->} (a\myprime \haskop{->} b\myprime)$, %
    an application $k\,h$ can be depicted as a \emph{box}:
    \In{align*}{
        \strdexternal\strdgathered{
            \strdmid,\strdrlabel{b\myprime}
            ,\strdbox{1}{1}{
                \strdmid,\strdrlabel{b}
                ,\strdcell{h}
                ,\strdmid,\strdrlabel{a}
            },\strdat{Left}{\strdcellof{strd overlabel,font=\normalsize}{k}}
            ,\strdmid,\strdrlabel{a\myprime}
        }
    }
    rather than
    \In{align*}{
        \strdexternal\strdgathered{
            \strdmid,\strdrlabel{a\myprime \haskop{->} b\myprime}
            ,\strdcell{k}
            ,\strdmid,\strdrlabel{a \haskop{->} b}
            ,\strdcell{h}
        }
    }
}


\definitionof{Functorial Tube}{
    Given a $\haskop{Functor} f$, an application of \haskop{fmap} %
    can be depicted as a \emph{tube} defined by 
    \In{align*}{
        \strdexternal\strdgathered{
            \strdfork{
                \strdmid,\strdrlabel{a}
                ,\strdcell{h}
                ,\strdmid,\strdrlabel{b}
            }
            ,\strdtube{
                \strdtubestartline
                ,\strdtubemid
                ,\strdtubemid
                ,\strdat{Left Start}{\strdcellof{strd overlabel}{f}}
                ,\strdtubeendline
            }
        } \mydefeq
        \strdexternal\strdgathered{
            \strdmid,\strdrlabel{fb}
            ,\strdbox{1}{1}{
                \strdmid,\strdrlabel{b}
                ,\strdcell{h}
                ,\strdmid,\strdrlabel{a}
            },\strdat{Left}{\strdoverlabel{\strdlvert{\haskop{fmap}}}}
            ,\strdmid,\strdrlabel{fa}
        }
    }
    Tube names are often omitted.
}

The functor laws state that ``tube then join" equals to ``join then tube" so that %
any diagram like
\In{align*}{
    \strdexternal\strdgathered{
        \strdfork{
            \strdmid,\strdrlabel{c}
            ,\strdcell{h}
            ,\strdmid,\strdrlabel{b}
            ,\strdcell{g}
            ,\strdmid,\strdrlabel{a}
        }
        ,\strdtube{
            \strdtubestartline
            ,\strdtubemid
            ,\strdtubemid
            ,\strdtubemid
            ,\strdtubeendline
        }
    }
}
has no ambiguity.


\subsection{Horizontal Composition}
\strdexternalname{strapp_string_diagrams_ex}

We will make string diagrams two-dimensional, equipped with the \emph{horizontal composition}.

\In{definition}{
    Parallel strings are pairs.
    \In{align*}{
        \strdexternal\strdgathered{
            \strdfork{
                \strdljump,\strdmid,\strdrlabel{a_1}
            }
            ,\strdmid,\strdrlabel{a_2}
        } \mydefeq
        \strdexternal\strdgathered{
            \strdmid,\strdrlabel{\haskprod{a_1}{a_2}}
        }
    }
}
Owing to the trivial bijections
\In{itemize}{
    \item $\haskprod{a_1}{\haskprod{a_2}{a_3}} \cong \haskprod{\haskprod{a_1}{a_2}}{a_3}$
    \item $\haskprod{a}{\haskone} \cong a \cong \haskprod{\haskone}{a}$
}
you can join any deeply nested pairs as far as their types are compatible, so that they are depicted as
\In{align*}{
    \strdexternal\strdgathered{
        \strdfork{
            \strdljump,\strdmid,\strdrlabel{a_1}
        }
        ,\strdfork{
            \strdmid,\strdrlabel{a_2}
        }
        ,\strdfork{
            \strdrjump,\strdmid,\strdrlabel{a_3}
        }
    }\cdots
    \strdexternal\strdgathered{
        \strdfork{
            \strdmid,\strdrlabel{a_n}
        }
    }
}
without parentheses.
\In{remark}{
    Of course these bijections must be explicitly inserted to your haskell code.
}



%\In{definition}{
\definitionof{Horizontal Composition}{
    Parallel nodes are defined by
    \In{align*}{
        \strdexternal\strdgathered{
            \strdfork{
                \strdmid,\strdrlabel{b_1}
                ,\strdcell{f_1}
                ,\strdmid,\strdrlabel{a_1}
            }
            ,\strdfork{
                \strdrjump
                ,\strdmid,\strdrlabel{b_2}
                ,\strdcell{f_2}
                ,\strdmid,\strdrlabel{a_2}
            }
        } \mydefeq
        \haskbackslash\haskprod{a_1}{a_2} \haskop{->} \haskprod{f_1\,a_1}{f_2\,a_2} 
    }
}

With these definitions, it is easy to check that:
\propositionof{Sliding}{
    \In{align*}{
        \strdexternal\strdgathered{
            \strdfork{
                \strdmid, \strdempty, \strdrlabel{b_1},
                \strdmid, 
                \strdcell{f_1},
                \strdmid, \strdrlabel{a_1}
            },
            \strdxscale{1.2}\strdrjump,
            \strdmid, \strdrlabel{b_2},
            \strdcell{f_2},
            \strdmid, \strdempty, \strdrlabel{a_2},
            \strdmid
        } =
        \strdexternal\strdgathered{
            \strdfork{
                \strdmid, \strdrlabel{b_1},
                \strdcell{f_1},
                \strdmid, \strdrlabel{a_1}
            },
            \strdxscale{1.2}\strdrjump, \strdmid, \strdrlabel{b_2},
            \strdcell{f_2},
            \strdmid, \strdrlabel{a_2}
        } =
        \strdexternal\strdgathered{
            \strdfork{
                \strdmid, \strdrlabel{b_1},
                \strdcell{f_1},
                \strdmid, \strdempty, \strdrlabel{a_1},
                \strdmid
            },
            \strdxscale{1.2}\strdrjump,
            \strdmid, \strdempty, \strdrlabel{b_2},
            \strdmid,
            \strdcell{f_2},
            \strdmid, \strdrlabel{a_2}
        }
    }
}


\subsection{Currying}
\strdexternalname{strapp_currying}

\definitionof{Band}{
    A special string for function types, a \emph{band} is defined by
    \In{align*}{
        \strdexternal\strdgathered{
            \strdroad\strdmid,\strdroadlabel{b}{a}
        } \mydefeq
        \strdexternal\strdgathered{
            \strdmid,\strdrlabel{a \haskop{->} b}
        }
    }
    Notice that the order of types is flipped. %
    So we often write $b \leftarrow a$ as $a \haskop{->} b$.
}


\definitionof{Currying}{
    With bands, currying is represented by
    \In{align*}{
        \strdexternal\strdgathered{
            \strdmid,\strdrlabel{c}
            ,\strdcell{f}
            ,\strdfork{
                \strdleft,\strdrlabel{a}
            }
            ,\strdright,\strdrlabel{b}
        } &\sim
        \strdexternal\strdgathered{
            \strdroad\strdmid,\strdroadlabel{c}{b}
            ,\strdcell{f}
            ,\strdmid,\strdrlabel{a}
        } \\
        f &\mapsto \haskbackslash a \haskop{->} \haskbackslash b \haskop{->} f \haskprod{a}{b} \\
        \haskbackslash \haskprod{a}{b} \haskop{->} f\,a\,b &\mymapsfrom f
    }
    We don't distinguish these two diagrams, %
    because ``move the right-side leg up and down" works correct in any form of diagrams.
}

The following definitions make bands cute.

\definitionof{Function Composition}{
    \In{align*}{
        \strdexternal\strdgathered{
            \strdroad\strdmid, \strdroadlabel{c}{a}
            , \strdfork{
                \strdroad\strdleft, \strdroadlabel{}{b}
            }
            , \strdroad\strdright
        } &\mydefeq
        \strdexternal\strdgathered{
            \strdroad\strdmid, \strdroadlabel{c}{a}
            , \strdcell{\haskop{.}}
            , \strdfork{
                \strdroad\strdleft, \strdroadlabel{c}{b}
            }
            , \strdroad\strdright, \strdroadlabel{b}{a}
        }
    }
}
or you can use a \emph{fat} form
\In{align*}{
    \strdexternal\strdgathered{
        \strdtubeof{}{
            \strdtubestart
            ,\strdtubeextend{1}{1},\strdbackground{strd roadcolor}
            ,\strdfork{
                \strdtubepartleft{1},\strdbackground{strd roadcolor}
                ,\strdat{Left}{\strdrlabel{c}}
            }
            ,\strdfork{
                \strdtubepartright{1},\strdbackground{strd roadcolor}
                ,\strdat{Right}{\strdllabel{a}}
                ,\strdat{Left}{\strdrlabel{b}}
            }
        }
    }
}

\definitionof{Identity Function}{
    \In{align*}{
        \strdexternal\strdgathered{
            \strdroad\strdmid, \strdroadlabel{}{a}
            , \strddeadend
        } \mydefeq
        \strdexternal\strdgathered{
            \strdroad\strdmid, \strdroadlabel{a}{a}
            , \strdcell{\haskop{id}}
        } \myeqdef
        \strdexternal\strdgathered{
            \strdtubeof{}{
                \strdtubestart
                ,\strdtubeclose,\strdbackground{strd roadcolor}
                ,\strdat{Right}{\strdllabel{a}}
            }
        }
    }
}

The following propositions are immediate.

\In{proposition}{[Unitality]
    \In{align*}{
        \strdexternal\strdgathered{
            \strdroad\strdmid, \strdroadlabel{b}{a}
            , \strdfork{
                \strdroad\strdleft, \strdroadlabel{}{a}
            }
            , \strdroad\strdright
            , \strddeadend
        } = 
        \strdexternal\strdgathered{
            \strdroad\strdmid, \strdroadlabel{b}{a}
        } =
        \strdexternal\strdgathered{
            \strdroad\strdmid, \strdroadlabel{b}{a}
            , \strdfork{
                \strdroad\strdleft, \strddeadend 
            }
            , \strdroad\strdright, \strdroadlabel{b}{}
        }
    }
}

\In{proposition}{[Associativity]
    \In{align*}{
        \strdexternal\strdgathered{
            \strdflip{
                \strdroad\strdmid, \strdroadlabel{d}{a}
                , \strdfork{
                    \strdroad\strdleft, \strdroadlabel{b}{}
                }
                , \strdroad\strdright
                , \strdfork{
                    \strdroad\strdleft, \strdroadlabel{}{}
                }
                , \strdroad\strdright, \strdroadlabel{}{c}
            }
        } =
        \strdexternal\strdgathered{
            \strdroad\strdmid, \strdroadlabel{d}{a}
            , \strdfork{
                \strdroad\strdleft, \strdroadlabel{}{c}
            }
            , \strdroad\strdright
            , \strdfork{
                \strdroad\strdleft, \strdroadlabel{}{}
            }
            , \strdroad\strdright, \strdroadlabel{b}{}
        } 
    }
}
to which we assign
\In{align*}{
    \strdexternal\strdgathered{
        \strdroad\strdmid,\strdroadlabel{d}{a}
        ,\strdfork{
            \strdroad\strdleft,\strdroadlabel{}{}
        }
        ,\strdfork{
            \strdroad\strdmid,\strdroadlabel{c}{b}
        }
        ,\strdfork{
            \strdroad\strdright,\strdroadlabel{}{}
        }
    }
}
A band that has more forks is similarly defined. The equations for fat forms are left as an exercise.
\mynewline
\indent For later use, we note the two famous operators.
\definitionof{Apply Operator}{
    \In{align*}{
        \strdexternal\strdgathered{
            \strdroad\strdmid,\strdroadlabel{b}{a}
            ,\strdcell{\texttt{\$}}
            ,\strdroad\strdmid,\strdroadlabel{b}{a}
        } \mydefeq
        \strdexternal\strdgathered{
            \strdroad\strdmid,\strdroadlabel{b}{a}
        }
    }
}

\definitionof{Comma Operator}{
    \In{align*}{
        \strdexternal\strdgathered{
            \strdfork{
                \strdljump
                ,\strdmid,\strdrlabel{a_1}
                ,\strdwidecell{0.5}{1.5}{\texttt{,}}
                ,\strdmid,\strdrlabel{a_1}
            }
            ,\strdmid,\strdrlabel{a_2}
            ,\strdmid,\strdrlabel{a_2}
        } \mydefeq
        \strdexternal\strdgathered{
            \strdfork{
                \strdljump,\strdmid,\strdrlabel{a_1}
            }
            ,\strdmid,\strdrlabel{a_2}
        }
    }
}

One can check immediately:
\In{proposition}{
    \In{align*}{
        \strdexternal\strdgathered{
            \strdmid,\strdrlabel{c}
            ,\strdcell{\texttt{\$}}
            ,\strdfork{
                \strdroad\strdleft,\strdroadlabel{c}{b}
                ,\strdcell{f}
                ,\strdmid,\strdrlabel{a}
            }
            ,\strdfork{
                \strdright,\strdrlabel{b}
            }
        } =
        \strdexternal\strdgathered{
            \strdmid,\strdrlabel{c}
            ,\strdcell{f}
            ,\strdfork{
                \strdleft,\strdrlabel{a}
            }
            ,\strdright,\strdrlabel{b}
        }
    }
}

\section{Applicative Functors}

\subsection{The Definition}
\strdexternalname{strapp_applicative_def}

Using diagrams, an $\texttt{Applicative}\,f$ consists of
\In{enumerate}{
    \item $\texttt{Functor}\,f$
    \item \In{math}{
        \strdexternal\strdgathered{
            \strdfork{
                \strdmid,\strdrlabel{a}
            }
            ,\strdtube{
                \strdtubestartline
                ,\strdtubemid
                ,\strdwidecell{1}{1}{\texttt{pure}}
            }
            ,\strdmid,\strdrlabel{a}
        }
    }
    \item \In{math}{
        \strdexternal\strdgathered{
            \strdfork{
                \strdmid,\strdrlabel{b},
                \strdwidecell{2}{2}{\texttt{<*>}},
                \strdfork{
                    \strdljump,\strdroad\strdmid,\strdroadlabel{b}{a}
                },
                \strdrjump,
                \strdmid,\strdrlabel{a}
            },
            \strdtube{
                \strdtubestartline,
                \strdtubemid,
                \strdfork{
                    \strdxscale{1}\strdtubeljump,\strdtubemid,\strdtubeendline
                },
                \strdxscale{1}\strdtuberjump,\strdtubemid,\strdtubeendline
            }
        }
    }
}
satisfying the following laws, which we can never understand,
\In{itemize}{
    \item \InList{math,aligned}{
        \strdexternal\strdgathered{
            \strdfork{
                \strdmid,\strdrlabel{a},
                \strdwidecell{2}{2}{\texttt{<*>}},
                \strdfork{
                    \strdljump,\strdroad\strdmid,\strdroadlabel{a}{a}
                },
                \strdrjump,
                \strdmid,\strdrlabel{a}
            },
            \strdtubestartline,
            \strdtube\strdtubemid,
            \strdfork{
                \strdtube{\strdxscale{1}\strdtubeljump,\strdtubemid,\strdtubeendline}
                ,\strdwidecell{1}{1}{\texttt{pure}}
                ,\strdroad\strdmid,\strddeadend,\strdroadlabel{}{a}
            },
            \strdtube{\strdxscale{1}\strdtuberjump,\strdtubemid,\strdtubeendline}
        } =
        \strdexternal\strdgathered{
            \strdfork{
                \strdmid,\strdrlabel{a}
            }
            ,\strdtube{
                \strdtubestartline
                ,\strdtubemid
                ,\strdtubeendline
            }
        }
    }
    \item \InList{math,aligned}{
        \strdexternal\strdgathered{
            \strdfork{
                \strdmid,\strdrlabel{b},
                \strdwidecell{2}{2}{\texttt{<*>}},
                \strdfork{
                    \strdljump,\strdroad\strdmid,\strdroadlabel{b}{a}
                },
                \strdrjump,
                \strdmid,\strdrlabel{a}
            },
            \strdtubestartline,
            \strdtube\strdtubemid,
            \strdfork{
                \strdtube{\strdxscale{1}\strdtubeljump,\strdtubemid,\strdtubeendline}
                ,\strdwidecell{1}{1}{\texttt{pure}}
                ,\strdroad\strdmid,\strdroadlabel{b}{a}
                ,\strdcell{h}
            },
            \strdtube{\strdxscale{1}\strdtuberjump,\strdtubemid,\strdtubeendline}
            ,\strdwidecell{1}{1}{\texttt{pure}}
            ,\strdmid,\strdrlabel{a}
        } =
        \strdexternal\strdgathered{
            \strdfork{
                \strdmid,\strdrlabel{b}
            }
            ,\strdtube{
                \strdtubestartline
                ,\strdtubemid
                ,\strdtubeendline
            }
            ,\strdwidecell{1}{1}{\texttt{pure}}
            ,\strdmid,\strdrlabel{b}
            ,\strdcell{h}
            ,\strdmid,\strdrlabel{a}
        }
    }
    \item \InList{math,aligned}{
        \strdexternal\strdgathered{
            \strdfork{
                \strdmid,\strdrlabel{b},
                \strdwidecell{2}{2}{\texttt{<*>}},
                \strdfork{
                    \strdljump,\strdroad\strdmid,\strdroadlabel{b}{a}
                },
                \strdrjump,
                \strdmid,\strdrlabel{a}
            },
            \strdtubestartline,
            \strdtube\strdtubemid,
            \strdfork{
                \strdtube{\strdxscale{1}\strdtubeljump,\strdtubemid,\strdtubeendline}
            },
            \strdtube{\strdxscale{1}\strdtuberjump,\strdtubemid,\strdtubeendline}
            ,\strdwidecell{1}{1}{\texttt{pure}}
            ,\strdmid,\strdrlabel{a}
            ,\strdcell{a}
        } =
        \strdexternal\strdgathered{
            \strdfork{
                \strdmid,\strdrlabel{b},
                \strdwidecell{2.8}{2.8}{\texttt{<*>}},
                \strdfork{
                    \strdxscale{1.5}\strdljump,\strdroad\strdmid,\strdroadlabel{b}{b{\leftarrow}a}
                },
                \strdxscale{1.5}\strdrjump,
                \strdroad\strdmid,\strdroadlabel{b}{a}
            },
            \strdtubestartline,
            \strdtube\strdtubemid,
            \strdfork{
                \strdtube{\strdxscale{1.5}\strdtubeljump,\strdtubeextend{0.2}{0.8},\strdtubemid,\strdtubeendline}
                ,\strdwidecell{1.5}{1.5}{\texttt{pure}}
                ,\strdroad\strdmid,\strdroadlabel{b}{b{\leftarrow}a}
                ,\strdroadlaside
                ,\strdbox{2}{2}{
                    \strdmid,\strdrlabel{b}
                    ,\strdcell{\texttt{\$}}
                    ,\strdfork{
                        \strdroad\strdleft,
                        \strdyhalf{\strdroad\strdmid},\strdat{Start}{\strdroadlabel{b}{a}}
                    }
                    ,\strdright,\strdrlabel{a}
                    ,\strdcell{a}
                    ,\strdyhalf{\strdjump}
                }%,\strdat{Left}{\strdoverlabel{\strdlvert{\texttt{curry}}}}
            },
            \strdtube{\strdxscale{1.5}\strdtuberjump,\strdtubemid,\strdtubeendline}
        }
    }
    \item \InList{math,aligned}{
        \strdexternal\strdgathered{
            \strdfork{
                \strdmid,\strdrlabel{c}
            }
            ,\strdtubestartline
            ,\strdtube\strdtubemid
            ,\strdwidecell{2}{2}{\texttt{<*>}}
            ,\strdfork{
                \strdxscale{1}\strdtubeljump
                ,\strdfork{
                    \strdroad\strdmid,\strdroadlabel{c}{b}
                }
                ,\strdtubestart
                ,\strdtube\strdtubemid
                ,\strdcutoff\strdtubebound
            }
            ,\strdxscale{1}\strdtuberjump
            ,\strdyscale{1.5}{
                \strdfork{
                    \strdmid,\strdrlabel{b}
                }
                ,\strdtubestart
                ,\strdtube\strdtubemid
            }
            ,\strdwidecell{2}{2}{\texttt{<*>}}
            ,\strdfork{
                \strdxscale{1}\strdtubeljump
                ,\strdfork{
                    \strdroad\strdmid,\strdroadlabel{b}{a}
                }
                ,\strdtubestart
                ,\strdtube\strdtubemid
                ,\strdcutoff\strdtubebound
            }
            ,\strdxscale{1}\strdtuberjump
            ,\strdyscale{1}{
                \strdfork{
                    \strdmid,\strdrlabel{a}
                }
                ,\strdtubestart
                ,\strdtube\strdtubemid
                ,\strdcutoff\strdtubebound
            }
        } =
        \strdexternal\strdgathered{
            \strdfork{
                \strdmid,\strdrlabel{c}
            }
            ,\strdtubestartline
            ,\strdtube\strdtubemid
            ,\strdwidecell{2}{2}{\texttt{<*>}}
            ,\strdfork{
                \strdxscale{1}\strdtuberjump
                ,\strdyscale{1}{
                    \strdfork{
                        \strdmid,\strdrlabel{a}
                    }
                    ,\strdtubestart
                    ,\strdtube\strdtubemid
                    ,\strdcutoff\strdtubebound
                }
            }
            ,\strdxscale{1}\strdtubeljump
            ,\strdyscale{1.5}{
                \strdfork{
                    \strdroad\strdmid,\strdroadlabel{c}{a}
                }
                ,\strdtubestart
                ,\strdtube\strdtubemid
            }
            ,\strdwidecell{2}{2}{\texttt{<*>} } 
            ,\strdfork{
                \strdxscale{1}\strdtuberjump
                ,\strdyscale{1}{
                    \strdfork{
                        \strdroad\strdmid,\strdroadlabel{b}{a}
                    }
                    ,\strdtubestart
                    ,\strdtube\strdtubemid
                    ,\strdcutoff\strdtubebound
                }
            }
            ,\strdxscale{1}\strdtubeljump
            ,\strdyscale{1.5}{
                \strdfork{
                    \strdroad\strdmid,\strdroadlabel{c{\ouroverlap\leftarrow}a}{b{\ouroverlap\leftarrow}a}
                }
                ,\strdtubestart
                ,\strdtube\strdtubemid
            }
            ,\strdwidecell{2}{2}{\texttt{<*>} }
            ,\strdfork{
                \strdxscale{1}\strdtuberjump
                ,\strdyscale{1}{
                    \strdfork{
                        \strdroad\strdmid,\strdroadlabel{c}{b}
                    }
                    ,\strdtubestart
                    ,\strdtube\strdtubemid
                    ,\strdcutoff\strdtubebound
                }
            }
            ,\strdxscale{1}\strdtubeljump
            ,\strdyscale{1.5}{
                \strdfork{
                    \strdroad\strdmid,\strdroadlabel{(c{\leftarrow}a){\leftarrow}(b{\ouroverlap\leftarrow}a)}{c{\ouroverlap\leftarrow}b}
                }
                ,\strdtubestart
                ,\strdtube\strdtubemid
            }
            ,\strdwidecell{1}{1}{\texttt{pure}}
            ,\strdroad\strdmid,\strdroadlabel{(c {\leftarrow} a){\leftarrow}(b {\leftarrow} a)}{c {\leftarrow} b}
            ,\strdcell{\haskop{.}}
        }
    }
    \item \InList{math,aligned}{
        \strdexternal\strdgathered{
            \strdfork{
                \strdmid,\strdrlabel{b},
                \strdwidecell{2}{2}{\texttt{<*>}},
                \strdfork{
                    \strdljump,\strdroad\strdmid,\strdroadlabel{b}{a}
                },
                \strdrjump,
                \strdmid,\strdrlabel{a}
            },
            \strdtubestartline,
            \strdtube\strdtubemid,
            \strdfork{
                \strdtube{\strdxscale{1}\strdtubeljump,\strdtubemid,\strdtubeendline}
                ,\strdwidecell{1}{1}{\texttt{pure}}
                ,\strdroad\strdmid,\strdroadlabel{b}{a}
            },
            \strdtube{\strdxscale{1}\strdtuberjump,\strdtubemid,\strdtubeendline}
        } =
        \strdexternal\strdgathered{
            \strdfork{
                \strdmid,\strdrlabel{b},
                \strdwidecell{2}{2}{\texttt{fmap}},
                \strdfork{
                    \strdljump,\strdroad\strdmid,\strdroadlabel{b}{a}
                },
                \strdrjump,
                \strdmid,\strdrlabel{a}
            },
            \strdtubestartline,
            \strdtube\strdtubemid,
            \strdtube{\strdxscale{1}\strdtuberjump,\strdtubemid,\strdtubeendline}
        }
    }
}

\In{remark}{
    The last law is redundant in case the \emph{free theorem}\cite{wadler1989theorems} enabled.
}


\subsection{Lax Functors}
\strdexternalname{strapp_lax}

To depict applicative functors cuter, we represent an applicative functor as a fork-able tube, %
which is called a \emph{lax functor} in category theory. 

\In{definition}{
    \In{align*}{
        \strdexternal\strdgathered{
            \strdfork{
                \strdyscale{0.5}{\strdimplicit\strdmid},
                \strdimplicit\strdmid,\strdrlabel{\texttt{()}}
            },
            \strdtubestartline,
            \strdtube{\strdyhalf\strdtubeclose}
        } &\mydefeq
        \strdexternal\strdgathered{
            \strdfork{
                \strdyscale{1}{\strdimplicit\strdmid},\strdrlabel{\texttt{()}},
                \strdimplicit\strdmid,\strdrlabel{\texttt{()}}
            },
            \strdtubestartline,
            \strdtube\strdtubemid,
            \strdwidecell{1}{1}{\texttt{pure}}
        }\\
        \strdexternal\strdgathered{
            \strdfork{
                \strdparallel{
                    \strdseq{\strdljump,\strdmid,\strdrlabel{a}},
                    \strdseq{\strdrjump,\strdmid,\strdrlabel{b}}
                }
            },
            \strdtubestart,
            \strdtubeextend{1}{1},\strdcutoff\strdtubebound,
            \strdparallel{
                \strdseq{\strdtube{\strdtubepartleft{1}},\strdcutoff\strdtubebound},
                \strdseq{\strdtube{\strdtubepartright{1}},\strdcutoff\strdtubebound}
            }
        } &\mydefeq
        \strdgathered{
            \strdfork{
                \strdparallel{
                    \strdseq{
                        \strdljump,\strdmid,\strdrlabel{a},
                        \strdroad\strdmid,\strdroadlabel{\haskprod{a}{b}}{b},
                        \strdcell{\texttt{,}},
                        \strdmid,\strdrlabel{a}
                    },
                    \strdseq{\strdrjump,\strdmid,\strdrlabel{b},\strdmid,\strdrlabel{b}}
                }
            },
            \strdtubestart,
            \strdtubeextend{2}{1},\strdcutoff\strdtubebound,\strdtube\strdtubemid,
            \strdwidecell{3}{2}{\texttt{<*>}},
            \strdtubestart,
            \strdtube{
                \strdparallel{
                    \strdseq{
                        \strdxscale{1}\strdtubeljump,\strdtubeextend{1}{0},
                        \strdtubemid,%\strdframelabelat{Left End}{\strdlvert{\texttt{fmap}^f\!}},
                        \strdtubemid,\strdcutoff\strdtubebound
                    },
                    \strdseq{\strdxscale{1}\strdtuberjump,\strdtubemid,\strdcutoff\strdtubebound}
                }
            }
        }
    }
} 

Under the applicative functor laws, one can check the following propositions that justify these pictures.

\propositionof{Naturality}{
    \In{align*}{
        \strdexternal\strdgathered{
            \strdfork{
                \strdparallel{
                    \strdseq{\strdljump,\strdmid,\strdmid,\strdat{Mid}{\strdcell{h}}},
                    \strdseq{\strdrjump,\strdmid,\strdmid,\strdat{Mid}{\strdcell{k}}},
                    \Identity
                }
            },
            \strdtube{
                \strdtubestart,
                \strdtubeextend{1}{1},\strdcutoff\strdtubebound,
                \strdparallel{
                    \strdseq{
                        \strdtubepartleft{1},
                        \strdcutoff\strdtubebound,
                        \strdtubemid,
                        \strdcutoff\strdtubebound
                    },
                    \strdseq{
                        \strdtubepartright{1},
                        \strdcutoff\strdtubebound,
                        \strdtubemid,
                        \strdcutoff\strdtubebound
                    }
                }
            }
        } &=
        \strdexternal\strdgathered{
            \strdfork{
                \strdparallel{
                    \strdseq{\strdljump,\strdmid,\strdat{Mid}{\strdcell{h}},\strdmid},
                    \strdseq{\strdrjump,\strdmid,\strdat{Mid}{\strdcell{k}},\strdmid},
                    \Identity
                }
            },
            \strdtube{
                \strdtubestart,
                \strdtubeextend{1}{1},\strdcutoff\strdtubebound,
                \strdtubemid,\strdcutoff\strdtubebound,
                \strdparallel{
                    \strdseq{
                        \strdtubepartleft{1},
                        \strdcutoff\strdtubebound
                    },
                    \strdseq{
                        \strdtubepartright{1},
                        \strdcutoff\strdtubebound
                    }
                }
            }
        } 
    }
}

%\In{proposition}{
\propositionof{Unitality}{
    \In{align*}{
        &
        \strdexternal\strdgathered{
            \strdfork{
                \strdparallel{
                    \strdseq{\strdrjump,\strdimplicit{\strdyscale{2}\strdmid}},
                    \strdseq{\strdljump,\strdydouble\strdmid},
                    \Identity
                }
            },
            \strdtube{
                \strdtubestart,
                \strdtubeextend{1}{1},\strdcutoff\strdtubebound,
                \strdparallel{
                    \strdseq{
                        \strdtubepartleft{1},
                        \strdcutoff\strdtubebound,
                        \strdtubemid,
                        \strdcutoff\strdtubebound
                    },
                    \strdseq{
                        \strdtubepartright{1},
                        \strdcutoff\strdtubebound,
                        \strdyhalf\strdtubeclose
                    }
                }
            }
        } =
        \strdexternal\strdgathered{
            \strdfork{
                \strdmid
            },
            \strdtube{
                \strdtubestart,\strdcutoff\strdtubebound,
                \strdtubemid,\strdcutoff\strdtubebound
            }
        } =
        \strdexternal\strdgathered{
            \strdflip{
                \strdfork{
                    \strdparallel{
                        \strdseq{\strdrjump,\strdimplicit{\strdyscale{2}\strdmid}},
                        \strdseq{\strdljump,\strdydouble\strdmid},
                        \Identity
                    }
                },
                \strdtube{
                    \strdtubestart,
                    \strdtubeextend{1}{1},\strdcutoff\strdtubebound,
                    \strdparallel{
                        \strdseq{
                            \strdtubepartleft{1},
                            \strdcutoff\strdtubebound,
                            \strdtubemid,
                            \strdcutoff\strdtubebound
                        },
                        \strdseq{
                            \strdtubepartright{1},
                            \strdcutoff\strdtubebound,
                            \strdyhalf\strdtubeclose
                        }
                    }
                }
            }
        }
    }
}

%\In{proposition}{
\propositionof{Associativity}{
    \In{align*}{
        &
        \strdexternal\strdgathered{
            \strdfork{
                \strdparallel{
                    \strdseq{\strdrjump,\strdydouble\strdmid},
                    \strdseq{\strdljump,\strdydouble\strdmid},
                    \strdseq{\strdljump,\strdxdouble\strdljump,\strdydouble\strdmid}
                }
            }
            ,
            \strdtube{
                \strdtubestart,
                \strdtubeextend{3}{1}, \strdcutoff\strdtubebound,
                \strdparallel{
                    \strdseq{
                        \strdtubepartleft{3},
                        \strdcutoff\strdtubebound,
                        \strdparallel{
                            \strdseq{\strdtubepartleft{1},\strdcutoff\strdtubebound},
                            \strdseq{\strdtubepartright{1},\strdcutoff\strdtubebound}
                        }
                    },
                    \strdseq{
                        \strdtubepartright{1},
                        \strdcutoff\strdtubebound,
                        \strdtubemid,
                        \strdcutoff\strdtubebound
                    }
                }
            }
        } =
        \strdexternal\strdgathered{
            \strdflip{
                \strdfork{
                    \strdparallel{
                        \strdseq{\strdrjump,\strdydouble\strdmid},
                        \strdseq{\strdljump,\strdydouble\strdmid},
                        \strdseq{\strdljump,\strdxdouble\strdljump,\strdydouble\strdmid}
                    }
                },
                \strdtube{
                    \strdtubestart,
                    \strdtubeextend{3}{1},\strdcutoff\strdtubebound,
                    \strdparallel{
                        \strdseq{
                            \strdtubepartleft{3},
                            \strdcutoff\strdtubebound,
                            \strdparallel{
                                \strdseq{\strdtubepartleft{1},\strdcutoff\strdtubebound},
                                \strdseq{\strdtubepartright{1},\strdcutoff\strdtubebound}
                            }
                        },
                        \strdseq{
                            \strdtubepartright{1},
                            \strdcutoff\strdtubebound,
                            \strdtubemid,
                            \strdcutoff\strdtubebound
                        }
                    }
                }
            }
        }
    }
}
to which we assign 
\In{align*}{
    \strdexternal\strdgathered{
        \strdfork{
            \strdrjump,
            \strdparallel{
                \strdseq{\strdrjump,\Identity\strdmid},
                \strdseq{\strdljump,\Identity\strdmid},
                \strdseq{\strdljump,\strdxdouble\strdljump,\Identity\strdmid}
            }
        },
        \strdtube{
            \strdtubestart,
            \strdtubeextend{2}{2},\strdcutoff\strdtubebound,
            \strdparallel{
                \strdseq{
                    \strdtubepartleft{1},
                    \strdcutoff\strdtubebound
                },
                \strdseq{
                    \strdtubepartmid{1}{1},
                    \strdcutoff\strdtubebound
                },
                \strdseq{
                    \strdtubepartright{1},
                    \strdcutoff\strdtubebound
                }
            }
        }
    }
}
A tube that has more forks can be similarly defined without ambiguity.
\In{remark}{
    In our diagrams, cutoff lines are preferred to parentheses.
}

Finally one can find our goal:
\In{proposition}{
    \In{align*}{
        \strdexternal\strdgathered{
            \strdfork{
                \strdmid,\strdrlabel{a},
                \strdwidecell{1}{1}{\texttt{pure}},
                \strdmid,\strdrlabel{a},
                \strdcell{a}
            },
            \strdtubestart,\strdcutoff\strdtubebound,
            \strdtube\strdtubemid
        } &=
        \strdexternal\strdgathered{
            \strdfork{
                \strdmid,\strdrlabel{a},
                \strdcell{a},
                \Identity
            },
            \strdtube{
                \strdtubestart,\strdcutoff\strdtubebound,
                \strdyscale{1.5}\strdtubemid,\strdcutoff\strdtubebound,%\strdtubelabelat{Left}{\strdlvert{\texttt{fmap}^f\!}},
                \strdyhalf\strdtubeclose
            }
        } \\
        \strdexternal\strdgathered{
            \strdfork{
                \strdmid,\strdrlabel{b},
                \strdwidecell{2}{2}{\texttt{<*>}},
                \strdfork{
                    \strdljump,\strdroad\strdmid,\strdroadlabel{b}{a}
                },
                \strdrjump,
                \strdmid,\strdrlabel{a}
            } ,
            \strdtube{
                \strdtubestart,\strdcutoff\strdtubebound,
                \strdtubemid,
                \strdfork{
                    \strdxscale{1}\strdtubeljump,\strdtubemid,\strdcutoff\strdtubebound
                }
                ,
                \strdxscale{1}\strdtuberjump,\strdtubemid,\strdcutoff\strdtubebound
            }
        } &=
        \strdexternal\strdgathered{
            \strdfork{
                \strdmid,\strdrlabel{b},
                \strdcell{\texttt{\$}},
                \strdfork{
                    \strdroad\strdleft,\strdroad\strdmid,\strdroadlabel{b}{a}
                },
                \strdright,\strdmid,\strdrlabel{a}
            },
            \strdtubestart,
            \strdtube{
                \strdtubeextend{1}{1},\strdcutoff\strdtubebound,
                \strdtubemid,%\strdtubellabel{\strdlvert{\texttt{fmap}^f\!}},
                \strdtubemid,
                \strdcutoff\strdtubebound,
                \strdfork{
                    \strdtubepartleft{1},\strdcutoff\strdtubebound
                },
                \strdtubepartright{1},\strdcutoff\strdtubebound,
                \Identity
            }
        }
    }
}

Thanks to these diagrams, you can immediately prove:
\propositionof{Lift}{
    \In{align*}{
        \strdexternal\strdgathered{
            \strdfork{
                \strdmid,\strdrlabel{c},
                \strdcell{h},
                \strdfork{
                    \strdleft,\strdrlabel{a}
                },
                \strdright,\strdrlabel{b}
            },
            \strdtube{
                \strdtubestart,
                \strdtubeextend{1}{1},\strdcutoff\strdtubebound,
                \strdtubemid,
                \strdfork{
                    \strdtubepartleft{1},\strdtubeend,\strdwidecell{1}{1}{x}
                },
                \strdtubepartright{1},\strdtubeend,\strdwidecell{1}{1}{y},
                \Identity
            }
        } = h \haskop{<\$>} x \haskop{<*>} y
    }
}

% Informally speaking, a \emph{lax functor} is a forked tube.
%
% Given monoidal categories $(\cat C,\otimes,I)$ and $(\cat C\myprime,\otimes\myprime,I\myprime)$, %
% a lax monoidal functor
% \In{align*}{
%     F : (\cat C,\otimes,I) \to (\cat C\myprime,\otimes\myprime,I\myprime)
% }
% consists of
% \In{enumerate}{
%     \item a functor $F : \cat C \to \cat D$ 
%     \item a natural transformation $(\phi_{A,B} : FA \otimes\myprime FB \to F(A \otimes B))_{A,B}$
%     \item a morphism $\phi _0 : I\myprime \to FI$
% }
% satisfying the coherence conditions

\include{references}

%\include{regression}

\end{document}
